function allowSaveGraph(){var a=myLine.toBase64Image()}function getGraphDataset(c,d,b){if(checkIfRateChecked(b)){d=_.map(d,function(f){return f+"_rate"});d[0]="year"}data=_.map(c,function(f){return _.pick(f,d)});if(b=="offenses"){years=[];data1=[];data2=[];data3=[];data4=[];for(var a=0;a<data.length;a++){years.push(data[a][d[0]]);data1.push(data[a][d[1]]);data2.push(data[a][d[2]]);data3.push(data[a][d[3]]);data4.push(data[a][d[4]])}final_data=[makeGraphObjects(data1,"#ca0020","Actual Offenses"),makeGraphObjects(data2,"#0571b0","Total Offenses Cleared"),makeGraphObjects(data3,"#7b3294","Offenses Cleared Involving Only Persons Under age 18"),makeGraphObjects(data4,"#008837","Unfounded Offenses")];final_data[0].hidden=false;final_data[1].hidden=false;final_data[2].hidden=false;final_data[3].hidden=false;if(!$("#actual").is(":checked")){final_data=_.filter(final_data,function(f){return f.label!="Actual Offenses"})}if(!$("#clearance").is(":checked")){final_data=_.filter(final_data,function(f){return f.label!="Total Offenses Cleared"})}if(!$("#clearance_under18").is(":checked")){final_data=_.filter(final_data,function(f){return f.label!="Offenses Cleared Involving Only Persons Under age 18"})}if(!$("#unfounded").is(":checked")){final_data=_.filter(final_data,function(f){return f.label!="Unfounded Offenses"})}}else{years=[];data1=[];for(var e=0;e<data.length;e++){years.push(data[e][d[0]]);data1.push(data[e][d[1]])}final_data=[makeGraphObjects(data1,"#ca0020",d[1])];final_data[0].hidden=false}return final_data}function makeGraphObjects(c,a,b){obj={borderColor:a,fill:false,label:b,data:c,onAnimationComplete:allowSaveGraph,hidden:true,radius:0};return obj}function makeGraph(d,a,c,b){title=getTitle(d,b);if(b=="offenses"){yaxis_label="# of Crimes";if(checkIfRateChecked(b)){yaxis_label="Rate per 100,000 Population"}legend_display=true}else{if(b=="arrests"){yaxis_label="# of Arrests";legend_display=false}else{if(b=="leoka"){yaxis_label="# of People";if(c[1].includes("killed")){yaxis_label="# of Officer Deaths"}else{if(c[1].includes("assault")){yaxis_label="# of Assaults"}}legend_display=false}}}graph_datasets=getGraphDataset(d,c,b);myLineChart=new Chart(a,{type:"line",data:{labels:years,datasets:graph_datasets},options:{legend:{display:legend_display},title:{display:true,position:"top",text:title,fontSize:22,fontColor:"black"},scales:{xAxes:[{ticks:{maxRotation:0,minRotation:0,autoSkip:true,maxTicksLimit:10,fontSize:14},scaleLabel:{fontSize:22,fontColor:"#000000",display:true,labelString:"Year"}}],yAxes:[{ticks:{beginAtZero:true,userCallback:function(g,f,e){g=g.toString();g=g.split(/(?=(?:...)*$)/);g=g.join(",");return g},fontSize:14},scaleLabel:{fontSize:22,fontColor:"#000000",display:true,labelString:yaxis_label}}]},responsive:true,tooltips:{mode:"index",intersect:false,callbacks:{label:function(e,f){value=e.yLabel;value=value.toString();value=value.split(/(?=(?:...)*$)/);value=value.join(",");return value}}},hover:{mode:"nearest",intersect:true}}});return(myLineChart)}function getTitle(b,a){title=b[0].agency+", ";title+=b[0].state+": ";if(a=="offenses"){title+=crime_values[$("#crime_dropdown").val()]}else{if(a=="arrests"){title+=arrest_values[$("#arrests_crime_dropdown").val()];title+=", "+arrest_categories[$("#arrests_category_dropdown").val()]}else{if(a=="leoka"){title+=leoka_values[$("#leoka_category_dropdown").val()]}}}if(checkIfRateChecked(a)){title+=" Rate"}return title}function fixTableName(a,b){temp_name=a;if(b=="offenses"){temp1=a.replace(/act_.*/,"Actual ");temp2=a.replace(/clr_18_.*/,"Clearance Under Age 18 ");temp3=a.replace(/clr_[a-z].*/,"Clearance ");temp4=a.replace(/unfound_.*/,"Unfounded ");a=a.replace(/act_|clr_18_|clr_|unfound_/,"");a=crime_values[a];if(temp1!=temp_name){a=temp1+a}if(temp2!=temp_name){a=temp2+a}if(temp3!=temp_name){a=temp3+a}if(temp4!=temp_name){a=temp4+a}if(a=="undefined"){a=temp_name}}else{if(b=="arrests"){a=a.replace(/_tot.*/g,"");a=arrest_values[a]}else{if(b=="leoka"){a=leoka_values[a]}}}if(checkIfRateChecked(b)&&!a.includes("agency")&&!a.includes("year")&&!a.includes("state")&&!a.includes("population")&&!a.includes("ORI")){a+=" Rate"}return a}function fixTableDataName(a,b){if(!a.includes("agency")&&!a.includes("year")&&!a.includes("state")&&!a.includes("population")&&!a.includes("ORI")){if(checkIfRateChecked(b)){a+="_rate"}}return a}function makeTable(f,d,e,c){d=subsetColumns(d,e,"table",c);data_keys=_.keys(d[0]);data_keys=data_keys.filter(function(g){return g!=="agency"&&g!=="year"&&g!=="state"&&g!=="ORI"});for(var a=0;a<d.length;a++){for(n=0;n<data_keys.length;n++){d[a][data_keys[n]]=parseFloat(d[a][data_keys[n]]).toLocaleString()}}z=[];for(var b=0;b<e.length;b++){label_name=fixTableName(e[b],c);data_name=fixTableDataName(e[b],c);z.push({data:data_name,title:label_name,className:"dt-head-left dt-body-right"})}temp_table=$(f).DataTable({data:d,columns:z,scrollX:true,sScrollXInner:"100%",sScrollX:"100%",stripe:true,hover:true,lengthChange:false,paging:false,searching:false,pageLength:100,ordering:true,order:[1,"desc"],fixedHeader:true,fixedColumns:{leftColumns:2}});return temp_table}function formatNumber(a){return a.replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,")};